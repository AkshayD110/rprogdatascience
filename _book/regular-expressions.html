<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>R Programming for Data Science</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="The R programming language has become the de facto programming language for data science. Its flexibility, power, sophistication, and expressiveness have made it an invaluable tool for data scientists around the world. This book is about the fundamentals of R programming. You will get started with the basics of the language, learn how to manipulate datasets, how to write functions, and how to debug and optimize code. With the fundamentals provided in this book, you will have a solid foundation on which to build your data science toolbox.">
  <meta name="generator" content="bookdown 0.1 and GitBook 2.6.7">

  <meta property="og:title" content="R Programming for Data Science" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://bookdown.org/rdpeng/rprogdatascience/" />
  <meta property="og:image" content="https://bookdown.org/rdpeng/rprogdatascience/cover_sm.png" />
  <meta property="og:description" content="The R programming language has become the de facto programming language for data science. Its flexibility, power, sophistication, and expressiveness have made it an invaluable tool for data scientists around the world. This book is about the fundamentals of R programming. You will get started with the basics of the language, learn how to manipulate datasets, how to write functions, and how to debug and optimize code. With the fundamentals provided in this book, you will have a solid foundation on which to build your data science toolbox." />
  <meta name="github-repo" content="rdpeng/rprogdatascience" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R Programming for Data Science" />
  
  <meta name="twitter:description" content="The R programming language has become the de facto programming language for data science. Its flexibility, power, sophistication, and expressiveness have made it an invaluable tool for data scientists around the world. This book is about the fundamentals of R programming. You will get started with the basics of the language, learn how to manipulate datasets, how to write functions, and how to debug and optimize code. With the fundamentals provided in this book, you will have a solid foundation on which to build your data science toolbox." />
  <meta name="twitter:image" content="https://bookdown.org/rdpeng/rprogdatascience/cover_sm.png" />

<meta name="author" content="Roger D. Peng">

<meta name="date" content="2016-07-06">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="loop-functions.html">
<link rel="next" href="debugging.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Programming for Data Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#stay-in-touch"><i class="fa fa-check"></i><b>1.1</b> Stay in Touch!</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i><b>2</b> Preface</a></li>
<li class="chapter" data-level="3" data-path="history-and-overview-of-r.html"><a href="history-and-overview-of-r.html"><i class="fa fa-check"></i><b>3</b> History and Overview of R</a><ul>
<li class="chapter" data-level="3.1" data-path="history-and-overview-of-r.html"><a href="history-and-overview-of-r.html#what-is-r"><i class="fa fa-check"></i><b>3.1</b> What is R?</a></li>
<li class="chapter" data-level="3.2" data-path="history-and-overview-of-r.html"><a href="history-and-overview-of-r.html#what-is-s"><i class="fa fa-check"></i><b>3.2</b> What is S?</a></li>
<li class="chapter" data-level="3.3" data-path="history-and-overview-of-r.html"><a href="history-and-overview-of-r.html#the-s-philosophy"><i class="fa fa-check"></i><b>3.3</b> The S Philosophy</a></li>
<li class="chapter" data-level="3.4" data-path="history-and-overview-of-r.html"><a href="history-and-overview-of-r.html#back-to-r"><i class="fa fa-check"></i><b>3.4</b> Back to R</a></li>
<li class="chapter" data-level="3.5" data-path="history-and-overview-of-r.html"><a href="history-and-overview-of-r.html#basic-features-of-r"><i class="fa fa-check"></i><b>3.5</b> Basic Features of R</a></li>
<li class="chapter" data-level="3.6" data-path="history-and-overview-of-r.html"><a href="history-and-overview-of-r.html#free-software"><i class="fa fa-check"></i><b>3.6</b> Free Software</a></li>
<li class="chapter" data-level="3.7" data-path="history-and-overview-of-r.html"><a href="history-and-overview-of-r.html#design-of-the-r-system"><i class="fa fa-check"></i><b>3.7</b> Design of the R System</a></li>
<li class="chapter" data-level="3.8" data-path="history-and-overview-of-r.html"><a href="history-and-overview-of-r.html#limitations-of-r"><i class="fa fa-check"></i><b>3.8</b> Limitations of R</a></li>
<li class="chapter" data-level="3.9" data-path="history-and-overview-of-r.html"><a href="history-and-overview-of-r.html#r-resources"><i class="fa fa-check"></i><b>3.9</b> R Resources</a><ul>
<li class="chapter" data-level="3.9.1" data-path="history-and-overview-of-r.html"><a href="history-and-overview-of-r.html#official-manuals"><i class="fa fa-check"></i><b>3.9.1</b> Official Manuals</a></li>
<li class="chapter" data-level="3.9.2" data-path="history-and-overview-of-r.html"><a href="history-and-overview-of-r.html#useful-standard-texts-on-s-and-r"><i class="fa fa-check"></i><b>3.9.2</b> Useful Standard Texts on S and R</a></li>
<li class="chapter" data-level="3.9.3" data-path="history-and-overview-of-r.html"><a href="history-and-overview-of-r.html#other-resources"><i class="fa fa-check"></i><b>3.9.3</b> Other Resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html"><i class="fa fa-check"></i><b>4</b> Getting Started with R</a><ul>
<li class="chapter" data-level="4.1" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#installation"><i class="fa fa-check"></i><b>4.1</b> Installation</a></li>
<li class="chapter" data-level="4.2" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#getting-started-with-the-r-interface"><i class="fa fa-check"></i><b>4.2</b> Getting started with the R interface</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="r-nuts-and-bolts.html"><a href="r-nuts-and-bolts.html"><i class="fa fa-check"></i><b>5</b> R Nuts and Bolts</a><ul>
<li class="chapter" data-level="5.1" data-path="r-nuts-and-bolts.html"><a href="r-nuts-and-bolts.html#entering-input"><i class="fa fa-check"></i><b>5.1</b> Entering Input</a></li>
<li class="chapter" data-level="5.2" data-path="r-nuts-and-bolts.html"><a href="r-nuts-and-bolts.html#evaluation"><i class="fa fa-check"></i><b>5.2</b> Evaluation</a></li>
<li class="chapter" data-level="5.3" data-path="r-nuts-and-bolts.html"><a href="r-nuts-and-bolts.html#r-objects"><i class="fa fa-check"></i><b>5.3</b> R Objects</a></li>
<li class="chapter" data-level="5.4" data-path="r-nuts-and-bolts.html"><a href="r-nuts-and-bolts.html#numbers"><i class="fa fa-check"></i><b>5.4</b> Numbers</a></li>
<li class="chapter" data-level="5.5" data-path="r-nuts-and-bolts.html"><a href="r-nuts-and-bolts.html#attributes"><i class="fa fa-check"></i><b>5.5</b> Attributes</a></li>
<li class="chapter" data-level="5.6" data-path="r-nuts-and-bolts.html"><a href="r-nuts-and-bolts.html#creating-vectors"><i class="fa fa-check"></i><b>5.6</b> Creating Vectors</a></li>
<li class="chapter" data-level="5.7" data-path="r-nuts-and-bolts.html"><a href="r-nuts-and-bolts.html#mixing-objects"><i class="fa fa-check"></i><b>5.7</b> Mixing Objects</a></li>
<li class="chapter" data-level="5.8" data-path="r-nuts-and-bolts.html"><a href="r-nuts-and-bolts.html#explicit-coercion"><i class="fa fa-check"></i><b>5.8</b> Explicit Coercion</a></li>
<li class="chapter" data-level="5.9" data-path="r-nuts-and-bolts.html"><a href="r-nuts-and-bolts.html#matrices"><i class="fa fa-check"></i><b>5.9</b> Matrices</a></li>
<li class="chapter" data-level="5.10" data-path="r-nuts-and-bolts.html"><a href="r-nuts-and-bolts.html#lists"><i class="fa fa-check"></i><b>5.10</b> Lists</a></li>
<li class="chapter" data-level="5.11" data-path="r-nuts-and-bolts.html"><a href="r-nuts-and-bolts.html#factors"><i class="fa fa-check"></i><b>5.11</b> Factors</a></li>
<li class="chapter" data-level="5.12" data-path="r-nuts-and-bolts.html"><a href="r-nuts-and-bolts.html#missing-values"><i class="fa fa-check"></i><b>5.12</b> Missing Values</a></li>
<li class="chapter" data-level="5.13" data-path="r-nuts-and-bolts.html"><a href="r-nuts-and-bolts.html#data-frames"><i class="fa fa-check"></i><b>5.13</b> Data Frames</a></li>
<li class="chapter" data-level="5.14" data-path="r-nuts-and-bolts.html"><a href="r-nuts-and-bolts.html#names"><i class="fa fa-check"></i><b>5.14</b> Names</a></li>
<li class="chapter" data-level="5.15" data-path="r-nuts-and-bolts.html"><a href="r-nuts-and-bolts.html#summary"><i class="fa fa-check"></i><b>5.15</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="getting-data-in-and-out-of-r.html"><a href="getting-data-in-and-out-of-r.html"><i class="fa fa-check"></i><b>6</b> Getting Data In and Out of R</a><ul>
<li class="chapter" data-level="6.1" data-path="getting-data-in-and-out-of-r.html"><a href="getting-data-in-and-out-of-r.html#reading-and-writing-data"><i class="fa fa-check"></i><b>6.1</b> Reading and Writing Data</a></li>
<li class="chapter" data-level="6.2" data-path="getting-data-in-and-out-of-r.html"><a href="getting-data-in-and-out-of-r.html#reading-data-files-with-read.table"><i class="fa fa-check"></i><b>6.2</b> Reading Data Files with <code>read.table()</code></a></li>
<li class="chapter" data-level="6.3" data-path="getting-data-in-and-out-of-r.html"><a href="getting-data-in-and-out-of-r.html#reading-in-larger-datasets-with-read.table"><i class="fa fa-check"></i><b>6.3</b> Reading in Larger Datasets with read.table</a></li>
<li class="chapter" data-level="6.4" data-path="getting-data-in-and-out-of-r.html"><a href="getting-data-in-and-out-of-r.html#calculating-memory-requirements-for-r-objects"><i class="fa fa-check"></i><b>6.4</b> Calculating Memory Requirements for R Objects</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="using-the-readr-package.html"><a href="using-the-readr-package.html"><i class="fa fa-check"></i><b>7</b> Using the <code>readr</code> Package</a></li>
<li class="chapter" data-level="8" data-path="using-textual-and-binary-formats-for-storing-data.html"><a href="using-textual-and-binary-formats-for-storing-data.html"><i class="fa fa-check"></i><b>8</b> Using Textual and Binary Formats for Storing Data</a><ul>
<li class="chapter" data-level="8.1" data-path="using-textual-and-binary-formats-for-storing-data.html"><a href="using-textual-and-binary-formats-for-storing-data.html#using-dput-and-dump"><i class="fa fa-check"></i><b>8.1</b> Using <code>dput()</code> and <code>dump()</code></a></li>
<li class="chapter" data-level="8.2" data-path="using-textual-and-binary-formats-for-storing-data.html"><a href="using-textual-and-binary-formats-for-storing-data.html#binary-formats"><i class="fa fa-check"></i><b>8.2</b> Binary Formats</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="interfaces-to-the-outside-world.html"><a href="interfaces-to-the-outside-world.html"><i class="fa fa-check"></i><b>9</b> Interfaces to the Outside World</a><ul>
<li class="chapter" data-level="9.1" data-path="interfaces-to-the-outside-world.html"><a href="interfaces-to-the-outside-world.html#file-connections"><i class="fa fa-check"></i><b>9.1</b> File Connections</a></li>
<li class="chapter" data-level="9.2" data-path="interfaces-to-the-outside-world.html"><a href="interfaces-to-the-outside-world.html#reading-lines-of-a-text-file"><i class="fa fa-check"></i><b>9.2</b> Reading Lines of a Text File</a></li>
<li class="chapter" data-level="9.3" data-path="interfaces-to-the-outside-world.html"><a href="interfaces-to-the-outside-world.html#reading-from-a-url-connection"><i class="fa fa-check"></i><b>9.3</b> Reading From a URL Connection</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="subsetting-r-objects.html"><a href="subsetting-r-objects.html"><i class="fa fa-check"></i><b>10</b> Subsetting R Objects</a><ul>
<li class="chapter" data-level="10.1" data-path="subsetting-r-objects.html"><a href="subsetting-r-objects.html#subsetting-a-vector"><i class="fa fa-check"></i><b>10.1</b> Subsetting a Vector</a></li>
<li class="chapter" data-level="10.2" data-path="subsetting-r-objects.html"><a href="subsetting-r-objects.html#subsetting-a-matrix"><i class="fa fa-check"></i><b>10.2</b> Subsetting a Matrix</a><ul>
<li class="chapter" data-level="10.2.1" data-path="subsetting-r-objects.html"><a href="subsetting-r-objects.html#dropping-matrix-dimensions"><i class="fa fa-check"></i><b>10.2.1</b> Dropping matrix dimensions</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="subsetting-r-objects.html"><a href="subsetting-r-objects.html#subsetting-lists"><i class="fa fa-check"></i><b>10.3</b> Subsetting Lists</a></li>
<li class="chapter" data-level="10.4" data-path="subsetting-r-objects.html"><a href="subsetting-r-objects.html#subsetting-nested-elements-of-a-list"><i class="fa fa-check"></i><b>10.4</b> Subsetting Nested Elements of a List</a></li>
<li class="chapter" data-level="10.5" data-path="subsetting-r-objects.html"><a href="subsetting-r-objects.html#extracting-multiple-elements-of-a-list"><i class="fa fa-check"></i><b>10.5</b> Extracting Multiple Elements of a List</a></li>
<li class="chapter" data-level="10.6" data-path="subsetting-r-objects.html"><a href="subsetting-r-objects.html#partial-matching"><i class="fa fa-check"></i><b>10.6</b> Partial Matching</a></li>
<li class="chapter" data-level="10.7" data-path="subsetting-r-objects.html"><a href="subsetting-r-objects.html#removing-na-values"><i class="fa fa-check"></i><b>10.7</b> Removing NA Values</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="vectorized-operations.html"><a href="vectorized-operations.html"><i class="fa fa-check"></i><b>11</b> Vectorized Operations</a><ul>
<li class="chapter" data-level="11.1" data-path="vectorized-operations.html"><a href="vectorized-operations.html#vectorized-matrix-operations"><i class="fa fa-check"></i><b>11.1</b> Vectorized Matrix Operations</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="dates-and-times.html"><a href="dates-and-times.html"><i class="fa fa-check"></i><b>12</b> Dates and Times</a><ul>
<li class="chapter" data-level="12.1" data-path="dates-and-times.html"><a href="dates-and-times.html#dates-in-r"><i class="fa fa-check"></i><b>12.1</b> Dates in R</a></li>
<li class="chapter" data-level="12.2" data-path="dates-and-times.html"><a href="dates-and-times.html#times-in-r"><i class="fa fa-check"></i><b>12.2</b> Times in R</a></li>
<li class="chapter" data-level="12.3" data-path="dates-and-times.html"><a href="dates-and-times.html#operations-on-dates-and-times"><i class="fa fa-check"></i><b>12.3</b> Operations on Dates and Times</a></li>
<li class="chapter" data-level="12.4" data-path="dates-and-times.html"><a href="dates-and-times.html#summary-1"><i class="fa fa-check"></i><b>12.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="managing-data-frames-with-the-dplyr-package.html"><a href="managing-data-frames-with-the-dplyr-package.html"><i class="fa fa-check"></i><b>13</b> Managing Data Frames with the <code>dplyr</code> package</a><ul>
<li class="chapter" data-level="13.1" data-path="managing-data-frames-with-the-dplyr-package.html"><a href="managing-data-frames-with-the-dplyr-package.html#data-frames-1"><i class="fa fa-check"></i><b>13.1</b> Data Frames</a></li>
<li class="chapter" data-level="13.2" data-path="managing-data-frames-with-the-dplyr-package.html"><a href="managing-data-frames-with-the-dplyr-package.html#the-dplyr-package"><i class="fa fa-check"></i><b>13.2</b> The <code>dplyr</code> Package</a></li>
<li class="chapter" data-level="13.3" data-path="managing-data-frames-with-the-dplyr-package.html"><a href="managing-data-frames-with-the-dplyr-package.html#dplyr-grammar"><i class="fa fa-check"></i><b>13.3</b> <code>dplyr</code> Grammar</a><ul>
<li class="chapter" data-level="13.3.1" data-path="managing-data-frames-with-the-dplyr-package.html"><a href="managing-data-frames-with-the-dplyr-package.html#common-dplyr-function-properties"><i class="fa fa-check"></i><b>13.3.1</b> Common <code>dplyr</code> Function Properties</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="managing-data-frames-with-the-dplyr-package.html"><a href="managing-data-frames-with-the-dplyr-package.html#installing-the-dplyr-package"><i class="fa fa-check"></i><b>13.4</b> Installing the <code>dplyr</code> package</a></li>
<li class="chapter" data-level="13.5" data-path="managing-data-frames-with-the-dplyr-package.html"><a href="managing-data-frames-with-the-dplyr-package.html#select"><i class="fa fa-check"></i><b>13.5</b> <code>select()</code></a></li>
<li class="chapter" data-level="13.6" data-path="managing-data-frames-with-the-dplyr-package.html"><a href="managing-data-frames-with-the-dplyr-package.html#filter"><i class="fa fa-check"></i><b>13.6</b> <code>filter()</code></a></li>
<li class="chapter" data-level="13.7" data-path="managing-data-frames-with-the-dplyr-package.html"><a href="managing-data-frames-with-the-dplyr-package.html#arrange"><i class="fa fa-check"></i><b>13.7</b> <code>arrange()</code></a></li>
<li class="chapter" data-level="13.8" data-path="managing-data-frames-with-the-dplyr-package.html"><a href="managing-data-frames-with-the-dplyr-package.html#rename"><i class="fa fa-check"></i><b>13.8</b> <code>rename()</code></a></li>
<li class="chapter" data-level="13.9" data-path="managing-data-frames-with-the-dplyr-package.html"><a href="managing-data-frames-with-the-dplyr-package.html#mutate"><i class="fa fa-check"></i><b>13.9</b> <code>mutate()</code></a></li>
<li class="chapter" data-level="13.10" data-path="managing-data-frames-with-the-dplyr-package.html"><a href="managing-data-frames-with-the-dplyr-package.html#group_by"><i class="fa fa-check"></i><b>13.10</b> <code>group_by()</code></a></li>
<li class="chapter" data-level="13.11" data-path="managing-data-frames-with-the-dplyr-package.html"><a href="managing-data-frames-with-the-dplyr-package.html#section"><i class="fa fa-check"></i><b>13.11</b> <code>%&gt;%</code></a></li>
<li class="chapter" data-level="13.12" data-path="managing-data-frames-with-the-dplyr-package.html"><a href="managing-data-frames-with-the-dplyr-package.html#summary-2"><i class="fa fa-check"></i><b>13.12</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="control-structures.html"><a href="control-structures.html"><i class="fa fa-check"></i><b>14</b> Control Structures</a><ul>
<li class="chapter" data-level="14.1" data-path="control-structures.html"><a href="control-structures.html#if-else"><i class="fa fa-check"></i><b>14.1</b> <code>if</code>-<code>else</code></a></li>
<li class="chapter" data-level="14.2" data-path="control-structures.html"><a href="control-structures.html#for-loops"><i class="fa fa-check"></i><b>14.2</b> <code>for</code> Loops</a></li>
<li class="chapter" data-level="14.3" data-path="control-structures.html"><a href="control-structures.html#nested-for-loops"><i class="fa fa-check"></i><b>14.3</b> Nested <code>for</code> loops</a></li>
<li class="chapter" data-level="14.4" data-path="control-structures.html"><a href="control-structures.html#while-loops"><i class="fa fa-check"></i><b>14.4</b> <code>while</code> Loops</a></li>
<li class="chapter" data-level="14.5" data-path="control-structures.html"><a href="control-structures.html#repeat-loops"><i class="fa fa-check"></i><b>14.5</b> <code>repeat</code> Loops</a></li>
<li class="chapter" data-level="14.6" data-path="control-structures.html"><a href="control-structures.html#next-break"><i class="fa fa-check"></i><b>14.6</b> <code>next</code>, <code>break</code></a></li>
<li class="chapter" data-level="14.7" data-path="control-structures.html"><a href="control-structures.html#summary-3"><i class="fa fa-check"></i><b>14.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>15</b> Functions</a><ul>
<li class="chapter" data-level="15.1" data-path="functions.html"><a href="functions.html#functions-in-r"><i class="fa fa-check"></i><b>15.1</b> Functions in R</a></li>
<li class="chapter" data-level="15.2" data-path="functions.html"><a href="functions.html#your-first-function"><i class="fa fa-check"></i><b>15.2</b> Your First Function</a></li>
<li class="chapter" data-level="15.3" data-path="functions.html"><a href="functions.html#argument-matching"><i class="fa fa-check"></i><b>15.3</b> Argument Matching</a></li>
<li class="chapter" data-level="15.4" data-path="functions.html"><a href="functions.html#lazy-evaluation"><i class="fa fa-check"></i><b>15.4</b> Lazy Evaluation</a></li>
<li class="chapter" data-level="15.5" data-path="functions.html"><a href="functions.html#the-...-argument"><i class="fa fa-check"></i><b>15.5</b> The <code>...</code> Argument</a></li>
<li class="chapter" data-level="15.6" data-path="functions.html"><a href="functions.html#arguments-coming-after-the-...-argument"><i class="fa fa-check"></i><b>15.6</b> Arguments Coming After the <code>...</code> Argument</a></li>
<li class="chapter" data-level="15.7" data-path="functions.html"><a href="functions.html#summary-4"><i class="fa fa-check"></i><b>15.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="loop-functions.html"><a href="loop-functions.html"><i class="fa fa-check"></i><b>16</b> Loop Functions</a><ul>
<li class="chapter" data-level="16.1" data-path="loop-functions.html"><a href="loop-functions.html#looping-on-the-command-line"><i class="fa fa-check"></i><b>16.1</b> Looping on the Command Line</a></li>
<li class="chapter" data-level="16.2" data-path="loop-functions.html"><a href="loop-functions.html#lapply"><i class="fa fa-check"></i><b>16.2</b> <code>lapply()</code></a></li>
<li class="chapter" data-level="16.3" data-path="loop-functions.html"><a href="loop-functions.html#sapply"><i class="fa fa-check"></i><b>16.3</b> <code>sapply()</code></a></li>
<li class="chapter" data-level="16.4" data-path="loop-functions.html"><a href="loop-functions.html#split"><i class="fa fa-check"></i><b>16.4</b> <code>split()</code></a></li>
<li class="chapter" data-level="16.5" data-path="loop-functions.html"><a href="loop-functions.html#splitting-a-data-frame"><i class="fa fa-check"></i><b>16.5</b> Splitting a Data Frame</a></li>
<li class="chapter" data-level="16.6" data-path="loop-functions.html"><a href="loop-functions.html#tapply"><i class="fa fa-check"></i><b>16.6</b> tapply</a></li>
<li class="chapter" data-level="16.7" data-path="loop-functions.html"><a href="loop-functions.html#apply"><i class="fa fa-check"></i><b>16.7</b> <code>apply()</code></a></li>
<li class="chapter" data-level="16.8" data-path="loop-functions.html"><a href="loop-functions.html#colrow-sums-and-means"><i class="fa fa-check"></i><b>16.8</b> Col/Row Sums and Means</a></li>
<li class="chapter" data-level="16.9" data-path="loop-functions.html"><a href="loop-functions.html#other-ways-to-apply"><i class="fa fa-check"></i><b>16.9</b> Other Ways to Apply</a></li>
<li class="chapter" data-level="16.10" data-path="loop-functions.html"><a href="loop-functions.html#mapply"><i class="fa fa-check"></i><b>16.10</b> <code>mapply()</code></a></li>
<li class="chapter" data-level="16.11" data-path="loop-functions.html"><a href="loop-functions.html#vectorizing-a-function"><i class="fa fa-check"></i><b>16.11</b> Vectorizing a Function</a></li>
<li class="chapter" data-level="16.12" data-path="loop-functions.html"><a href="loop-functions.html#summary-5"><i class="fa fa-check"></i><b>16.12</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="regular-expressions.html"><a href="regular-expressions.html"><i class="fa fa-check"></i><b>17</b> Regular Expressions</a><ul>
<li class="chapter" data-level="17.1" data-path="regular-expressions.html"><a href="regular-expressions.html#before-you-begin"><i class="fa fa-check"></i><b>17.1</b> Before You Begin</a></li>
<li class="chapter" data-level="17.2" data-path="regular-expressions.html"><a href="regular-expressions.html#primary-r-functions"><i class="fa fa-check"></i><b>17.2</b> Primary R Functions</a></li>
<li class="chapter" data-level="17.3" data-path="regular-expressions.html"><a href="regular-expressions.html#grep"><i class="fa fa-check"></i><b>17.3</b> <code>grep()</code></a></li>
<li class="chapter" data-level="17.4" data-path="regular-expressions.html"><a href="regular-expressions.html#grepl"><i class="fa fa-check"></i><b>17.4</b> <code>grepl()</code></a></li>
<li class="chapter" data-level="17.5" data-path="regular-expressions.html"><a href="regular-expressions.html#regexpr"><i class="fa fa-check"></i><b>17.5</b> <code>regexpr()</code></a></li>
<li class="chapter" data-level="17.6" data-path="regular-expressions.html"><a href="regular-expressions.html#sub-and-gsub"><i class="fa fa-check"></i><b>17.6</b> <code>sub()</code> and <code>gsub()</code></a></li>
<li class="chapter" data-level="17.7" data-path="regular-expressions.html"><a href="regular-expressions.html#regexec"><i class="fa fa-check"></i><b>17.7</b> <code>regexec()</code></a></li>
<li class="chapter" data-level="17.8" data-path="regular-expressions.html"><a href="regular-expressions.html#summary-6"><i class="fa fa-check"></i><b>17.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>18</b> Debugging</a><ul>
<li class="chapter" data-level="18.1" data-path="debugging.html"><a href="debugging.html#somethings-wrong"><i class="fa fa-check"></i><b>18.1</b> Something’s Wrong!</a></li>
<li class="chapter" data-level="18.2" data-path="debugging.html"><a href="debugging.html#figuring-out-whats-wrong"><i class="fa fa-check"></i><b>18.2</b> Figuring Out What’s Wrong</a></li>
<li class="chapter" data-level="18.3" data-path="debugging.html"><a href="debugging.html#debugging-tools-in-r"><i class="fa fa-check"></i><b>18.3</b> Debugging Tools in R</a></li>
<li class="chapter" data-level="18.4" data-path="debugging.html"><a href="debugging.html#using-traceback"><i class="fa fa-check"></i><b>18.4</b> Using <code>traceback()</code></a></li>
<li class="chapter" data-level="18.5" data-path="debugging.html"><a href="debugging.html#using-debug"><i class="fa fa-check"></i><b>18.5</b> Using <code>debug()</code></a></li>
<li class="chapter" data-level="18.6" data-path="debugging.html"><a href="debugging.html#using-recover"><i class="fa fa-check"></i><b>18.6</b> Using <code>recover()</code></a></li>
<li class="chapter" data-level="18.7" data-path="debugging.html"><a href="debugging.html#summary-7"><i class="fa fa-check"></i><b>18.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="profiling-r-code.html"><a href="profiling-r-code.html"><i class="fa fa-check"></i><b>19</b> Profiling R Code</a><ul>
<li class="chapter" data-level="19.1" data-path="profiling-r-code.html"><a href="profiling-r-code.html#using-system.time"><i class="fa fa-check"></i><b>19.1</b> Using <code>system.time()</code></a></li>
<li class="chapter" data-level="19.2" data-path="profiling-r-code.html"><a href="profiling-r-code.html#timing-longer-expressions"><i class="fa fa-check"></i><b>19.2</b> Timing Longer Expressions</a></li>
<li class="chapter" data-level="19.3" data-path="profiling-r-code.html"><a href="profiling-r-code.html#the-r-profiler"><i class="fa fa-check"></i><b>19.3</b> The R Profiler</a></li>
<li class="chapter" data-level="19.4" data-path="profiling-r-code.html"><a href="profiling-r-code.html#using-summaryrprof"><i class="fa fa-check"></i><b>19.4</b> Using <code>summaryRprof()</code></a></li>
<li class="chapter" data-level="19.5" data-path="profiling-r-code.html"><a href="profiling-r-code.html#summary-8"><i class="fa fa-check"></i><b>19.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="simulation.html"><a href="simulation.html"><i class="fa fa-check"></i><b>20</b> Simulation</a><ul>
<li class="chapter" data-level="20.1" data-path="simulation.html"><a href="simulation.html#generating-random-numbers"><i class="fa fa-check"></i><b>20.1</b> Generating Random Numbers</a></li>
<li class="chapter" data-level="20.2" data-path="simulation.html"><a href="simulation.html#setting-the-random-number-seed"><i class="fa fa-check"></i><b>20.2</b> Setting the random number seed</a></li>
<li class="chapter" data-level="20.3" data-path="simulation.html"><a href="simulation.html#simulating-a-linear-model"><i class="fa fa-check"></i><b>20.3</b> Simulating a Linear Model</a></li>
<li class="chapter" data-level="20.4" data-path="simulation.html"><a href="simulation.html#random-sampling"><i class="fa fa-check"></i><b>20.4</b> Random Sampling</a></li>
<li class="chapter" data-level="20.5" data-path="simulation.html"><a href="simulation.html#summary-9"><i class="fa fa-check"></i><b>20.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html"><a href="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html"><i class="fa fa-check"></i><b>21</b> Data Analysis Case Study: Changes in Fine Particle Air Pollution in the U.S.</a><ul>
<li class="chapter" data-level="21.1" data-path="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html"><a href="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html#synopsis"><i class="fa fa-check"></i><b>21.1</b> Synopsis</a></li>
<li class="chapter" data-level="21.2" data-path="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html"><a href="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html#loading-and-processing-the-raw-data"><i class="fa fa-check"></i><b>21.2</b> Loading and Processing the Raw Data</a><ul>
<li class="chapter" data-level="21.2.1" data-path="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html"><a href="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html#reading-in-the-1999-data"><i class="fa fa-check"></i><b>21.2.1</b> Reading in the 1999 data</a></li>
<li class="chapter" data-level="21.2.2" data-path="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html"><a href="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html#reading-in-the-2012-data"><i class="fa fa-check"></i><b>21.2.2</b> Reading in the 2012 data</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html"><a href="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html#results"><i class="fa fa-check"></i><b>21.3</b> Results</a><ul>
<li class="chapter" data-level="21.3.1" data-path="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html"><a href="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html#entire-u.s.-analysis"><i class="fa fa-check"></i><b>21.3.1</b> Entire U.S. analysis</a></li>
<li class="chapter" data-level="21.3.2" data-path="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html"><a href="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html#changes-in-pm-levels-at-an-individual-monitor"><i class="fa fa-check"></i><b>21.3.2</b> Changes in PM levels at an individual monitor</a></li>
<li class="chapter" data-level="21.3.3" data-path="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html"><a href="data-analysis-case-study-changes-in-fine-particle-air-pollution-in-the-u-s-.html#changes-in-state-wide-pm-levels"><i class="fa fa-check"></i><b>21.3.3</b> Changes in state-wide PM levels</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="parallel-computation.html"><a href="parallel-computation.html"><i class="fa fa-check"></i><b>22</b> Parallel Computation</a><ul>
<li class="chapter" data-level="22.1" data-path="parallel-computation.html"><a href="parallel-computation.html#hidden-parallelism"><i class="fa fa-check"></i><b>22.1</b> Hidden Parallelism</a><ul>
<li class="chapter" data-level="22.1.1" data-path="parallel-computation.html"><a href="parallel-computation.html#parallel-blas"><i class="fa fa-check"></i><b>22.1.1</b> Parallel BLAS</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="parallel-computation.html"><a href="parallel-computation.html#embarrassing-parallelism"><i class="fa fa-check"></i><b>22.2</b> Embarrassing Parallelism</a></li>
<li class="chapter" data-level="22.3" data-path="parallel-computation.html"><a href="parallel-computation.html#the-parallel-package"><i class="fa fa-check"></i><b>22.3</b> The Parallel Package</a><ul>
<li class="chapter" data-level="22.3.1" data-path="parallel-computation.html"><a href="parallel-computation.html#mclapply"><i class="fa fa-check"></i><b>22.3.1</b> <code>mclapply()</code></a></li>
<li class="chapter" data-level="22.3.2" data-path="parallel-computation.html"><a href="parallel-computation.html#error-handling"><i class="fa fa-check"></i><b>22.3.2</b> Error Handling</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="parallel-computation.html"><a href="parallel-computation.html#example-bootstrapping-a-statistic"><i class="fa fa-check"></i><b>22.4</b> Example: Bootstrapping a Statistic</a><ul>
<li class="chapter" data-level="22.4.1" data-path="parallel-computation.html"><a href="parallel-computation.html#generating-random-numbers-1"><i class="fa fa-check"></i><b>22.4.1</b> Generating Random Numbers</a></li>
<li class="chapter" data-level="22.4.2" data-path="parallel-computation.html"><a href="parallel-computation.html#using-the-boot-package"><i class="fa fa-check"></i><b>22.4.2</b> Using the <code>boot</code> package</a></li>
</ul></li>
<li class="chapter" data-level="22.5" data-path="parallel-computation.html"><a href="parallel-computation.html#building-a-socket-cluster"><i class="fa fa-check"></i><b>22.5</b> Building a Socket Cluster</a></li>
<li class="chapter" data-level="22.6" data-path="parallel-computation.html"><a href="parallel-computation.html#summary-10"><i class="fa fa-check"></i><b>22.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="about-the-author.html"><a href="about-the-author.html"><i class="fa fa-check"></i><b>23</b> About the Author</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Programming for Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="regular-expressions" class="section level1">
<h1><span class="header-section-number">17</span> Regular Expressions</h1>
<p><a href="https://www.youtube.com/watch?v=q8SzNKib5-4">Watch a video of this chapter</a></p>
<div id="before-you-begin" class="section level2">
<h2><span class="header-section-number">17.1</span> Before You Begin</h2>
<p>If you want a very quick introduction to the general notion of regular expressions and how they can be used to process text (as opposed to how to implement them specifically in R), you should watch <a href="https://www.youtube.com/watch?v=NvHjYOilOf8">this lecture</a> first.</p>
</div>
<div id="primary-r-functions" class="section level2">
<h2><span class="header-section-number">17.2</span> Primary R Functions</h2>
<p>The primary R functions for dealing with regular expressions are</p>
<ul>
<li><p><code>grep()</code>, <code>grepl()</code>: These functions search for matches of a regular expression/pattern in a character vector. <code>grep()</code> returns the indices into the character vector that contain a match or the specific strings that happen to have the match. <code>grepl()</code> returns a <code>TRUE</code>/<code>FALSE</code> vector indicating which elements of the character vector contain a match</p></li>
<li><p><code>regexpr()</code>, <code>gregexpr()</code>: Search a character vector for regular expression matches and return the indices of the string where the match begins and the length of the match</p></li>
<li><p><code>sub()</code>, <code>gsub()</code>: Search a character vector for regular expression matches and replace that match with another string</p></li>
<li><p><code>regexec()</code>: This function searches a character vector for a regular expression, much like <code>regexpr()</code>, but it will additionally return the locations of any parenthesized sub-expressions. Probably easier to explain through demonstration.</p></li>
</ul>
<p>For this chapter, we will use a running example using data from homicides in Baltimore City. The Baltimore Sun newspaper collects information on all homicides that occur in the city (it also reports on many of them). That data is collected and presented in a <a href="http://data.baltimoresun.com/bing-maps/homicides/">map that is publically available</a>. I encourage you to go look at the web site/map to get a sense of what kinds of data are presented there. Unfortunately, the data on the web site are not particularly amenable to analysis, so I’ve scraped the data and put it in a separate file. The data in this file contain data from January 2007 to October 2013.</p>
<p>Here is an excerpt of the Baltimore City homicides dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>homicides &lt;-<span class="st"> </span><span class="kw">readLines</span>(<span class="st">&quot;homicides.txt&quot;</span>)
&gt;<span class="st"> </span>
<span class="er">&gt;</span><span class="st"> </span>## Total number of events recorded
<span class="er">&gt;</span><span class="st"> </span><span class="kw">length</span>(homicides)
[<span class="dv">1</span>] <span class="dv">1571</span>
&gt;<span class="st"> </span>homicides[<span class="dv">1</span>]
[<span class="dv">1</span>] <span class="st">&quot;39.311024, -76.674227, iconHomicideShooting, &#39;p2&#39;, &#39;&lt;dl&gt;&lt;dt&gt;Leon Nelson&lt;/dt&gt;&lt;dd class=</span><span class="ch">\&quot;</span><span class="st">address</span><span class="ch">\&quot;</span><span class="st">&gt;3400 Clifton Ave.&lt;br /&gt;Baltimore, MD 21216&lt;/dd&gt;&lt;dd&gt;black male, 17 years old&lt;/dd&gt;&lt;dd&gt;Found on January 1, 2007&lt;/dd&gt;&lt;dd&gt;Victim died at Shock Trauma&lt;/dd&gt;&lt;dd&gt;Cause: shooting&lt;/dd&gt;&lt;/dl&gt;&#39;&quot;</span>
&gt;<span class="st"> </span>homicides[<span class="dv">1000</span>]
[<span class="dv">1</span>] <span class="st">&quot;39.33626300000, -76.55553990000, icon_homicide_shooting, &#39;p1200&#39;, &#39;&lt;dl&gt;&lt;dt&gt;&lt;a href=</span><span class="ch">\&quot;</span><span class="st">http://essentials.baltimoresun.com/micro_sun/homicides/victim/1200/davon-diggs</span><span class="ch">\&quot;</span><span class="st">&gt;Davon Diggs&lt;/a&gt;&lt;/dt&gt;&lt;dd class=</span><span class="ch">\&quot;</span><span class="st">address</span><span class="ch">\&quot;</span><span class="st">&gt;4100 Parkwood Ave&lt;br /&gt;Baltimore, MD 21206&lt;/dd&gt;&lt;dd&gt;Race: Black&lt;br /&gt;Gender: male&lt;br /&gt;Age: 21 years old&lt;/dd&gt;&lt;dd&gt;Found on November  5, 2011&lt;/dd&gt;&lt;dd&gt;Victim died at Johns Hopkins Bayview Medical Center &lt;/dd&gt;&lt;dd&gt;Cause: Shooting&lt;/dd&gt;&lt;dd class=</span><span class="ch">\&quot;</span><span class="st">popup-note</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;p&gt;Originally reported in 5000 Belair Road; later determined to be rear alley of 4100 block Parkwood&lt;/p&gt;&lt;/dd&gt;&lt;/dl&gt;&#39;&quot;</span></code></pre></div>
<p>The data set is formatted so that each homicide is presented on a single line of text. So when we read the data in with <code>readLines()</code>, each element of the character vector represents one homicide event. Notice that the data are riddled with HTML tags because they were scraped directly from the web site.</p>
<p>A few interesting features stand out: We have the latitude and longitude of where the victim was found; then there’s the street address; the age, race, and gender of the victim; the date on which the victim was found; in which hospital the victim ultimately died; the cause of death.</p>
</div>
<div id="grep" class="section level2">
<h2><span class="header-section-number">17.3</span> <code>grep()</code></h2>
<p>Suppose we wanted to identify the records for all the victims of shootings (as opposed to other causes)? How could we do that? From the map we know that for each cause of death there is a different icon/flag placed on the map. In particular, they are different colors. You can see that is indicated in the dataset for shooting deaths with a <code>iconHomicideShooting</code> label. Perhaps we can use this aspect of the data to idenfity all of the shootings.</p>
<p>Here I use <code>grep()</code> to match the literal <code>iconHomicideShooting</code> into the character vector of homicides.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>g &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;iconHomicideShooting&quot;</span>, homicides)
&gt;<span class="st"> </span><span class="kw">length</span>(g)
[<span class="dv">1</span>] <span class="dv">228</span></code></pre></div>
<p>Using this approach I get 228 shooting deaths. However, I notice that for some of the entries, the indicator for the homicide “flag” is noted as <code>icon_homicide_shooting</code>. It’s not uncommon over time for web site maintainers to change the names of files or update files. What happens if we now <code>grep()</code> on both icon names using the <code>|</code> operator?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>g &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;iconHomicideShooting|icon_homicide_shooting&quot;</span>, homicides)
&gt;<span class="st"> </span><span class="kw">length</span>(g)
[<span class="dv">1</span>] <span class="dv">1263</span></code></pre></div>
<p>Now we have 1263 shooting deaths, which is quite a bit more. In fact, the vast majority of homicides in Baltimore are shooting deaths.</p>
<p>Another possible way to do this is to <code>grep()</code> on the cause of death field, which seems to have the format <code>Cause: shooting</code>. We can <code>grep()</code> on this literally and get</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>g &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;Cause: shooting&quot;</span>, homicides)
&gt;<span class="st"> </span><span class="kw">length</span>(g)
[<span class="dv">1</span>] <span class="dv">228</span></code></pre></div>
<p>Notice that we seem to be undercounting again. This is because for some of the entries, the word “shooting” uses a captial “S” while other entries use a lower case “s”. We can handle this variation by using a character class in our regular expression.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>g &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;Cause: [Ss]hooting&quot;</span>, homicides)
&gt;<span class="st"> </span><span class="kw">length</span>(g)
[<span class="dv">1</span>] <span class="dv">1263</span></code></pre></div>
<p>One thing you have to be careful of when processing text data is not not <code>grep()</code> things out of context. For example, suppose we just <code>grep()</code>-ed on the expression <code>[Ss]hooting</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>g &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;[Ss]hooting&quot;</span>, homicides)
&gt;<span class="st"> </span><span class="kw">length</span>(g)
[<span class="dv">1</span>] <span class="dv">1265</span></code></pre></div>
<p>Notice that we see to pick up 2 extra homicides this way. We can figure out which ones they are by comparing the results of the two expressions.</p>
<p>First we can get the indices for the first expresssion match.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>i &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;[cC]ause: [Ss]hooting&quot;</span>, homicides)
&gt;<span class="st"> </span><span class="kw">str</span>(i)
 int [<span class="dv">1</span>:<span class="dv">1263</span>] <span class="dv">1</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">9</span> <span class="dv">10</span> <span class="dv">11</span> <span class="dv">12</span> <span class="dv">13</span> ...</code></pre></div>
<p>Then we can get the indices for just matching on <code>[Ss]hooting</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>j &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;[Ss]hooting&quot;</span>, homicides)
&gt;<span class="st"> </span><span class="kw">str</span>(j)
 int [<span class="dv">1</span>:<span class="dv">1265</span>] <span class="dv">1</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">9</span> <span class="dv">10</span> <span class="dv">11</span> <span class="dv">12</span> <span class="dv">13</span> ...</code></pre></div>
<p>Now we just need to identify which are the entries that the vectors <code>i</code> and <code>j</code> do <em>not</em> have in common.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">setdiff</span>(i, j)
<span class="kw">integer</span>(<span class="dv">0</span>)
&gt;<span class="st"> </span><span class="kw">setdiff</span>(j, i)
[<span class="dv">1</span>] <span class="dv">318</span> <span class="dv">859</span></code></pre></div>
<p>Here we can see that the index vector <code>j</code> has two entries that are not in <code>i</code>: entries 318, 859. We can take a look at these entries directly to see what makes them different.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>homicides[<span class="dv">859</span>]
[<span class="dv">1</span>] <span class="st">&quot;39.33743900000, -76.66316500000, icon_homicide_bluntforce, &#39;p914&#39;, &#39;&lt;dl&gt;&lt;dt&gt;&lt;a href=</span><span class="ch">\&quot;</span><span class="st">http://essentials.baltimoresun.com/micro_sun/homicides/victim/914/steven-harris</span><span class="ch">\&quot;</span><span class="st">&gt;Steven Harris&lt;/a&gt;&lt;/dt&gt;&lt;dd class=</span><span class="ch">\&quot;</span><span class="st">address</span><span class="ch">\&quot;</span><span class="st">&gt;4200 Pimlico Road&lt;br /&gt;Baltimore, MD 21215&lt;/dd&gt;&lt;dd&gt;Race: Black&lt;br /&gt;Gender: male&lt;br /&gt;Age: 38 years old&lt;/dd&gt;&lt;dd&gt;Found on July 29, 2010&lt;/dd&gt;&lt;dd&gt;Victim died at Scene&lt;/dd&gt;&lt;dd&gt;Cause: Blunt Force&lt;/dd&gt;&lt;dd class=</span><span class="ch">\&quot;</span><span class="st">popup-note</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;p&gt;Harris was found dead July 22 and ruled a shooting victim; an autopsy subsequently showed that he had not been shot,...&lt;/dd&gt;&lt;/dl&gt;&#39;&quot;</span></code></pre></div>
<p>Here we can see that the word “shooting” appears in the narrative text that accompanies the data, but the ultimate cause of death was in fact blunt force.</p>
<p>A&gt; When developing a regular expression to extract entries from a large dataset, it’s important that you understand the formatting of the dataset well enough so that you can develop a specific expression that doesn’t accidentally grep data out of context.</p>
<p>Sometimes we want to identify elements of a character vector that match a pattern, but instead of returning their indices we want the actual values that satisfy the match. For example, we may want to identify all of the states in the United States whose names start with “New”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;^New&quot;</span>, state.name)
[<span class="dv">1</span>] <span class="dv">29</span> <span class="dv">30</span> <span class="dv">31</span> <span class="dv">32</span></code></pre></div>
<p>This gives us the indices into the <code>state.name</code> variable that match, but setting <code>value = TRUE</code> returns the actual elements of the character vector that match.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;^New&quot;</span>, state.name, <span class="dt">value =</span> <span class="ot">TRUE</span>)
[<span class="dv">1</span>] <span class="st">&quot;New Hampshire&quot;</span> <span class="st">&quot;New Jersey&quot;</span>    <span class="st">&quot;New Mexico&quot;</span>    <span class="st">&quot;New York&quot;</span>     </code></pre></div>
</div>
<div id="grepl" class="section level2">
<h2><span class="header-section-number">17.4</span> <code>grepl()</code></h2>
<p>The function <code>grepl()</code> works much like <code>grep()</code> except that it differs in its return value. <code>grepl()</code> returns a logical vector indicating which element of a character vector contains the match. For example, suppose we want to know which states in the United States begin with word “New”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>g &lt;-<span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;^New&quot;</span>, state.name)
&gt;<span class="st"> </span>g
 [<span class="dv">1</span>] <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span>
[<span class="dv">12</span>] <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span>
[<span class="dv">23</span>] <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span>  <span class="ot">TRUE</span>  <span class="ot">TRUE</span>  <span class="ot">TRUE</span>  <span class="ot">TRUE</span> <span class="ot">FALSE</span>
[<span class="dv">34</span>] <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span>
[<span class="dv">45</span>] <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span>
&gt;<span class="st"> </span>state.name[g]
[<span class="dv">1</span>] <span class="st">&quot;New Hampshire&quot;</span> <span class="st">&quot;New Jersey&quot;</span>    <span class="st">&quot;New Mexico&quot;</span>    <span class="st">&quot;New York&quot;</span>     </code></pre></div>
<p>Here, we can see that <code>grepl()</code> returns a logical vector that can be used to subset the original <code>state.name</code> vector.</p>
</div>
<div id="regexpr" class="section level2">
<h2><span class="header-section-number">17.5</span> <code>regexpr()</code></h2>
<p>Both the <code>grep()</code> and the <code>grepl()</code> functions have some limitations. In particular, both functions tell you which strings in a character vector match a certain pattern but they don’t tell you exactly where the match occurs or what the match is for a more complicated regular expression.</p>
<p>The <code>regexpr()</code> function gives you the (a) index into each string where the match begins and the (b) length of the match for that string. <code>regexpr()</code> only gives you the <em>first</em> match of the string (reading left to right). <code>gregexpr()</code> will give you <em>all</em> of the matches in a given string if there are is more than one match.</p>
<p>In our Baltimore City homicides dataset, we might be interested in finding the date on which each victim was found. Taking a look at the dataset</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>homicides[<span class="dv">1</span>]
[<span class="dv">1</span>] <span class="st">&quot;39.311024, -76.674227, iconHomicideShooting, &#39;p2&#39;, &#39;&lt;dl&gt;&lt;dt&gt;Leon Nelson&lt;/dt&gt;&lt;dd class=</span><span class="ch">\&quot;</span><span class="st">address</span><span class="ch">\&quot;</span><span class="st">&gt;3400 Clifton Ave.&lt;br /&gt;Baltimore, MD 21216&lt;/dd&gt;&lt;dd&gt;black male, 17 years old&lt;/dd&gt;&lt;dd&gt;Found on January 1, 2007&lt;/dd&gt;&lt;dd&gt;Victim died at Shock Trauma&lt;/dd&gt;&lt;dd&gt;Cause: shooting&lt;/dd&gt;&lt;/dl&gt;&#39;&quot;</span></code></pre></div>
<p>it seems that we might be able to just <code>grep</code> on the word “Found”. However, the word “found” may be found elsewhere in the entry, such as in this entry, where the word “found” appears in the narrative text at the end.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>homicides[<span class="dv">954</span>]
[<span class="dv">1</span>] <span class="st">&quot;39.30677400000, -76.59891100000, icon_homicide_shooting, &#39;p816&#39;, &#39;&lt;dl&gt;&lt;dt&gt;&lt;a href=</span><span class="ch">\&quot;</span><span class="st">http://essentials.baltimoresun.com/micro_sun/homicides/victim/816/kenly-wheeler</span><span class="ch">\&quot;</span><span class="st">&gt;Kenly Wheeler&lt;/a&gt;&lt;/dt&gt;&lt;dd class=</span><span class="ch">\&quot;</span><span class="st">address</span><span class="ch">\&quot;</span><span class="st">&gt;1400 N Caroline St&lt;br /&gt;Baltimore, MD 21213&lt;/dd&gt;&lt;dd&gt;Race: Black&lt;br /&gt;Gender: male&lt;br /&gt;Age: 29 years old&lt;/dd&gt;&lt;dd&gt;Found on March  3, 2010&lt;/dd&gt;&lt;dd&gt;Victim died at Scene&lt;/dd&gt;&lt;dd&gt;Cause: Shooting&lt;/dd&gt;&lt;dd class=</span><span class="ch">\&quot;</span><span class="st">popup-note</span><span class="ch">\&quot;</span><span class="st">&gt;&lt;p&gt;Wheeler</span><span class="ch">\\</span><span class="st">&#39;s body was&amp;nbsp;found on the grounds of Dr. Bernard Harris Sr.&amp;nbsp;Elementary School&lt;/p&gt;&lt;/dd&gt;&lt;/dl&gt;&#39;&quot;</span></code></pre></div>
<p>But we can see that the date is typically preceded by “Found on” and is surrounded by <code>&lt;dd&gt;&lt;/dd&gt;</code> tags, so let’s use the pattern <code>&lt;dd&gt;[F|f]ound(.*)&lt;/dd&gt;</code> and see what it brings up.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">regexpr</span>(<span class="st">&quot;&lt;dd&gt;[F|f]ound(.*)&lt;/dd&gt;&quot;</span>, homicides[<span class="dv">1</span>:<span class="dv">10</span>])
 [<span class="dv">1</span>] <span class="dv">177</span> <span class="dv">178</span> <span class="dv">188</span> <span class="dv">189</span> <span class="dv">178</span> <span class="dv">182</span> <span class="dv">178</span> <span class="dv">187</span> <span class="dv">182</span> <span class="dv">183</span>
<span class="kw">attr</span>(,<span class="st">&quot;match.length&quot;</span>)
 [<span class="dv">1</span>] <span class="dv">93</span> <span class="dv">86</span> <span class="dv">89</span> <span class="dv">90</span> <span class="dv">89</span> <span class="dv">84</span> <span class="dv">85</span> <span class="dv">84</span> <span class="dv">88</span> <span class="dv">84</span>
<span class="kw">attr</span>(,<span class="st">&quot;useBytes&quot;</span>)
[<span class="dv">1</span>] <span class="ot">TRUE</span></code></pre></div>
<p>We can use the <code>substr()</code> function to extract the first match in the first string.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">substr</span>(homicides[<span class="dv">1</span>], <span class="dv">177</span>, <span class="dv">177</span> +<span class="st"> </span><span class="dv">93</span> -<span class="st"> </span><span class="dv">1</span>)
[<span class="dv">1</span>] <span class="st">&quot;&lt;dd&gt;Found on January 1, 2007&lt;/dd&gt;&lt;dd&gt;Victim died at Shock Trauma&lt;/dd&gt;&lt;dd&gt;Cause: shooting&lt;/dd&gt;&quot;</span></code></pre></div>
<p>Immediately, we can see that the regular expression picked up too much information. This is because the previous pattern was too greedy and matched too much of the string. We need to use the <code>?</code> metacharacter to make the regular expression “lazy” so that it stops at the <em>first</em> <code>&lt;/dd&gt;</code> tag.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">regexpr</span>(<span class="st">&quot;&lt;dd&gt;[F|f]ound(.*?)&lt;/dd&gt;&quot;</span>, homicides[<span class="dv">1</span>:<span class="dv">10</span>])
 [<span class="dv">1</span>] <span class="dv">177</span> <span class="dv">178</span> <span class="dv">188</span> <span class="dv">189</span> <span class="dv">178</span> <span class="dv">182</span> <span class="dv">178</span> <span class="dv">187</span> <span class="dv">182</span> <span class="dv">183</span>
<span class="kw">attr</span>(,<span class="st">&quot;match.length&quot;</span>)
 [<span class="dv">1</span>] <span class="dv">33</span> <span class="dv">33</span> <span class="dv">33</span> <span class="dv">33</span> <span class="dv">33</span> <span class="dv">33</span> <span class="dv">33</span> <span class="dv">33</span> <span class="dv">33</span> <span class="dv">33</span>
<span class="kw">attr</span>(,<span class="st">&quot;useBytes&quot;</span>)
[<span class="dv">1</span>] <span class="ot">TRUE</span></code></pre></div>
<p>Now when we look at the substrings indicated by the <code>regexpr()</code> output, we get</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">substr</span>(homicides[<span class="dv">1</span>], <span class="dv">177</span>, <span class="dv">177</span> +<span class="st"> </span><span class="dv">33</span> -<span class="st"> </span><span class="dv">1</span>)
[<span class="dv">1</span>] <span class="st">&quot;&lt;dd&gt;Found on January 1, 2007&lt;/dd&gt;&quot;</span></code></pre></div>
<p>While it’s straightforward to take the output of <code>regexpr()</code> and feed it into <code>substr()</code> to get the matches out of the original data, one handy function is <code>regmatches()</code> which extracts the matches in the strings for you without you having to use <code>substr()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>r &lt;-<span class="st"> </span><span class="kw">regexpr</span>(<span class="st">&quot;&lt;dd&gt;[F|f]ound(.*?)&lt;/dd&gt;&quot;</span>, homicides[<span class="dv">1</span>:<span class="dv">5</span>])
&gt;<span class="st"> </span><span class="kw">regmatches</span>(homicides[<span class="dv">1</span>:<span class="dv">5</span>], r)
[<span class="dv">1</span>] <span class="st">&quot;&lt;dd&gt;Found on January 1, 2007&lt;/dd&gt;&quot;</span> <span class="st">&quot;&lt;dd&gt;Found on January 2, 2007&lt;/dd&gt;&quot;</span>
[<span class="dv">3</span>] <span class="st">&quot;&lt;dd&gt;Found on January 2, 2007&lt;/dd&gt;&quot;</span> <span class="st">&quot;&lt;dd&gt;Found on January 3, 2007&lt;/dd&gt;&quot;</span>
[<span class="dv">5</span>] <span class="st">&quot;&lt;dd&gt;Found on January 5, 2007&lt;/dd&gt;&quot;</span></code></pre></div>
</div>
<div id="sub-and-gsub" class="section level2">
<h2><span class="header-section-number">17.6</span> <code>sub()</code> and <code>gsub()</code></h2>
<p>Sometimes we need to clean things up or modify strings by matching a pattern and replacing it with something else. For example, how can we extract the date from this string?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>x &lt;-<span class="st"> </span><span class="kw">substr</span>(homicides[<span class="dv">1</span>], <span class="dv">177</span>, <span class="dv">177</span> +<span class="st"> </span><span class="dv">33</span> -<span class="st"> </span><span class="dv">1</span>)
&gt;<span class="st"> </span>x
[<span class="dv">1</span>] <span class="st">&quot;&lt;dd&gt;Found on January 1, 2007&lt;/dd&gt;&quot;</span></code></pre></div>
<p>We want to strip out the stuff surrounding the “January 1, 2007” portion. We can do that by matching on the text that comes before and after it using the <code>|</code> operator and then replacing it with the empty string.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">sub</span>(<span class="st">&quot;&lt;dd&gt;[F|f]ound on |&lt;/dd&gt;&quot;</span>, <span class="st">&quot;&quot;</span>, x)
[<span class="dv">1</span>] <span class="st">&quot;January 1, 2007&lt;/dd&gt;&quot;</span></code></pre></div>
<p>Notice that the <code>sub()</code> function found the first match (at the beginning of the string) and replaced it and then stopped. However, there was another match at the end of the string that we also wanted to replace. To get both matches, we need the <code>gsub()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;&lt;dd&gt;[F|f]ound on |&lt;/dd&gt;&quot;</span>, <span class="st">&quot;&quot;</span>, x)
[<span class="dv">1</span>] <span class="st">&quot;January 1, 2007&quot;</span></code></pre></div>
<p>The <code>sub() and</code>gsub()` functions can take vector arguments so we don’t have to process each string one by one.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>r &lt;-<span class="st"> </span><span class="kw">regexpr</span>(<span class="st">&quot;&lt;dd&gt;[F|f]ound(.*?)&lt;/dd&gt;&quot;</span>, homicides[<span class="dv">1</span>:<span class="dv">5</span>])
&gt;<span class="st"> </span>m &lt;-<span class="st"> </span><span class="kw">regmatches</span>(homicides[<span class="dv">1</span>:<span class="dv">5</span>], r)
&gt;<span class="st"> </span>m
[<span class="dv">1</span>] <span class="st">&quot;&lt;dd&gt;Found on January 1, 2007&lt;/dd&gt;&quot;</span> <span class="st">&quot;&lt;dd&gt;Found on January 2, 2007&lt;/dd&gt;&quot;</span>
[<span class="dv">3</span>] <span class="st">&quot;&lt;dd&gt;Found on January 2, 2007&lt;/dd&gt;&quot;</span> <span class="st">&quot;&lt;dd&gt;Found on January 3, 2007&lt;/dd&gt;&quot;</span>
[<span class="dv">5</span>] <span class="st">&quot;&lt;dd&gt;Found on January 5, 2007&lt;/dd&gt;&quot;</span>
&gt;<span class="st"> </span>d &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;&lt;dd&gt;[F|f]ound on |&lt;/dd&gt;&quot;</span>, <span class="st">&quot;&quot;</span>, m)
&gt;<span class="st"> </span>
<span class="er">&gt;</span><span class="st"> </span>## Nice and clean
<span class="er">&gt;</span><span class="st"> </span>d
[<span class="dv">1</span>] <span class="st">&quot;January 1, 2007&quot;</span> <span class="st">&quot;January 2, 2007&quot;</span> <span class="st">&quot;January 2, 2007&quot;</span> <span class="st">&quot;January 3, 2007&quot;</span>
[<span class="dv">5</span>] <span class="st">&quot;January 5, 2007&quot;</span></code></pre></div>
<p>Finally, it may be useful to convert these strings to the <code>Date</code> class so that we can do some date-related computations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">as.Date</span>(d, <span class="st">&quot;%B %d, %Y&quot;</span>)
[<span class="dv">1</span>] <span class="st">&quot;2007-01-01&quot;</span> <span class="st">&quot;2007-01-02&quot;</span> <span class="st">&quot;2007-01-02&quot;</span> <span class="st">&quot;2007-01-03&quot;</span> <span class="st">&quot;2007-01-05&quot;</span></code></pre></div>
</div>
<div id="regexec" class="section level2">
<h2><span class="header-section-number">17.7</span> <code>regexec()</code></h2>
<p>The <code>regexec()</code> function works like <code>regexpr()</code> except it gives you the indices for parenthesized sub-expressions. For example, take a look at the following expression.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">regexec</span>(<span class="st">&quot;&lt;dd&gt;[F|f]ound on (.*?)&lt;/dd&gt;&quot;</span>, homicides[<span class="dv">1</span>])
[[<span class="dv">1</span>]]
[<span class="dv">1</span>] <span class="dv">177</span> <span class="dv">190</span>
<span class="kw">attr</span>(,<span class="st">&quot;match.length&quot;</span>)
[<span class="dv">1</span>] <span class="dv">33</span> <span class="dv">15</span>
<span class="kw">attr</span>(,<span class="st">&quot;useBytes&quot;</span>)
[<span class="dv">1</span>] <span class="ot">TRUE</span></code></pre></div>
<p>Notice first that the regular expression itself has a portion in parentheses <code>()</code>. That is the portion of the expression that I presume will contain the date. In the output, you’ll notice that there are two indices and two “match.length” values. The first index tells you where the overall match begins (character 177) and the second index tells you where the expression in the parentheses begins (character 190).</p>
<p>By contrast, if we only use the <code>regexpr()</code> function, we get</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">regexec</span>(<span class="st">&quot;&lt;dd&gt;[F|f]ound on .*?&lt;/dd&gt;&quot;</span>, homicides[<span class="dv">1</span>])
[[<span class="dv">1</span>]]
[<span class="dv">1</span>] <span class="dv">177</span>
<span class="kw">attr</span>(,<span class="st">&quot;match.length&quot;</span>)
[<span class="dv">1</span>] <span class="dv">33</span>
<span class="kw">attr</span>(,<span class="st">&quot;useBytes&quot;</span>)
[<span class="dv">1</span>] <span class="ot">TRUE</span></code></pre></div>
<p>We can use the <code>substr()</code> function to demonstrate which parts of a strings are matched by the <code>regexec()</code> function.</p>
<p>Here’s the output for <code>regexec()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">regexec</span>(<span class="st">&quot;&lt;dd&gt;[F|f]ound on (.*?)&lt;/dd&gt;&quot;</span>, homicides[<span class="dv">1</span>])
[[<span class="dv">1</span>]]
[<span class="dv">1</span>] <span class="dv">177</span> <span class="dv">190</span>
<span class="kw">attr</span>(,<span class="st">&quot;match.length&quot;</span>)
[<span class="dv">1</span>] <span class="dv">33</span> <span class="dv">15</span>
<span class="kw">attr</span>(,<span class="st">&quot;useBytes&quot;</span>)
[<span class="dv">1</span>] <span class="ot">TRUE</span></code></pre></div>
<p>Here’s the overall expression match.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">substr</span>(homicides[<span class="dv">1</span>], <span class="dv">177</span>, <span class="dv">177</span> +<span class="st"> </span><span class="dv">33</span> -<span class="st"> </span><span class="dv">1</span>)
[<span class="dv">1</span>] <span class="st">&quot;&lt;dd&gt;Found on January 1, 2007&lt;/dd&gt;&quot;</span></code></pre></div>
<p>And here’s the parenthesized sub-expression.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">substr</span>(homicides[<span class="dv">1</span>], <span class="dv">190</span>, <span class="dv">190</span> +<span class="st"> </span><span class="dv">15</span> -<span class="st"> </span><span class="dv">1</span>)
[<span class="dv">1</span>] <span class="st">&quot;January 1, 2007&quot;</span></code></pre></div>
<p>All this can be done much more easily with the <code>regmatches()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>r &lt;-<span class="st"> </span><span class="kw">regexec</span>(<span class="st">&quot;&lt;dd&gt;[F|f]ound on (.*?)&lt;/dd&gt;&quot;</span>, homicides[<span class="dv">1</span>:<span class="dv">2</span>])
&gt;<span class="st"> </span><span class="kw">regmatches</span>(homicides[<span class="dv">1</span>:<span class="dv">2</span>], r)
[[<span class="dv">1</span>]]
[<span class="dv">1</span>] <span class="st">&quot;&lt;dd&gt;Found on January 1, 2007&lt;/dd&gt;&quot;</span> <span class="st">&quot;January 1, 2007&quot;</span>                  

[[<span class="dv">2</span>]]
[<span class="dv">1</span>] <span class="st">&quot;&lt;dd&gt;Found on January 2, 2007&lt;/dd&gt;&quot;</span> <span class="st">&quot;January 2, 2007&quot;</span>                  </code></pre></div>
<p>Notice that <code>regmatches()</code> returns a list in this case, where each element of the list contains two strings: the overall match and the parenthesized sub-expression.</p>
<p>As an example, we can make a plot of monthly homicide counts. First we need a regular expression to capture the dates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>r &lt;-<span class="st"> </span><span class="kw">regexec</span>(<span class="st">&quot;&lt;dd&gt;[F|f]ound on (.*?)&lt;/dd&gt;&quot;</span>, homicides)
&gt;<span class="st"> </span>m &lt;-<span class="st"> </span><span class="kw">regmatches</span>(homicides, r)</code></pre></div>
<p>Then we can loop through the list returned by <code>regmatches()</code> and extract the second element of each (the parenthesized sub-expression).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>dates &lt;-<span class="st"> </span><span class="kw">sapply</span>(m, function(x) x[<span class="dv">2</span>])</code></pre></div>
<p>Finally, we can convert the date strings into the <code>Date</code> class and make a histogram of the counts.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>dates &lt;-<span class="st"> </span><span class="kw">as.Date</span>(dates, <span class="st">&quot;%B %d, %Y&quot;</span>)
&gt;<span class="st"> </span><span class="kw">hist</span>(dates, <span class="st">&quot;month&quot;</span>, <span class="dt">freq =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">&quot;Monthly Homicides in Baltimore&quot;</span>)</code></pre></div>
<p><img src="images/regex-unnamed-chunk-35-1.png" width="672" /></p>
<p>We can see from the picture that homicides do not occur uniformly throughout the year and appear to have some seasonality to them.</p>
</div>
<div id="summary-6" class="section level2">
<h2><span class="header-section-number">17.8</span> Summary</h2>
<p>The primary R functions for dealing with regular expressions are</p>
<ul>
<li><p><code>grep()</code>, <code>grepl()</code>: Search for matches of a regular expression/pattern in a character vector</p></li>
<li><p><code>regexpr()</code>, <code>gregexpr(): Search a character vector for regular expression matches and return the indices where the match begins; useful in conjunction with</code>regmatches()`</p></li>
<li><p><code>sub()</code>, <code>gsub()</code>: Search a character vector for regular expression matches and replace that match with another string</p></li>
<li><p><code>regexec()</code>: Gives you indices of parethensized sub-expressions.</p></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="loop-functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="debugging.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rdpeng/rprogdatascience/edit/bookdown/regex.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
